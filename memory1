import pygame, sys
from pygame.locals import QUIT
import random

pygame.init()

largeur = 800
hauteur = 600

fenetre = pygame.display.set_mode((largeur, hauteur))

pygame.display.set_caption("Memory V1")

fenetre.fill("#298CCC")

FPS = 60

horloge = pygame.time.Clock()

carte_largeur = 100
carte_hauteur = 100
espacement = 10
nb_lignes = 4
nb_colonnes = 4

nb_paires = nb_lignes * nb_colonnes // 2


essais = 0

nombres = []

for nombre in range(nb_paires):
    nombres.append(str(nombre))

paires = nombres * 2

random.shuffle(paires)

cartes = []

for ligne in range(nb_lignes):
    for colonne in range(nb_colonnes):
        x = colonne * (carte_largeur + espacement) + (largeur - (carte_largeur + espacement) * nb_colonnes) // 2
        y = ligne * (carte_hauteur + espacement) + (hauteur - (carte_hauteur + espacement) * nb_lignes) // 2
        carte = {
            "valeur_carte": paires.pop(),
            "dessin_carte": pygame.Rect(x, y , carte_largeur, carte_hauteur),
            "carte_retournee": False,
            "carte_identique": False
        }

        cartes.append(carte)

typo = pygame.font.Font(None, 50)

for carte in cartes:
    pygame.draw.rect(fenetre, "yellow", carte["dessin_carte"])

cartes_retournees = []
paires_trouvees = 0

while True:
    if nb_paires % 2 != 0:
        texte_surface = typo.render("Impair Ã§a va pas le faire", True, "red")
        fenetre.blit(texte_surface, (0,0))
        
        pygame.display.update()


    if paires_trouvees == nb_lignes * nb_colonnes // 2:
        texte_surface = typo.render(f"Bravo, tu as reussi en {int(essais)} essais", True, "black")
        fenetre.blit(texte_surface, (0,0))
        
        pygame.display.update()

    for event in pygame.event.get():
        if event.type == QUIT:
            pygame.quit()
            sys.exit()

        if event.type == pygame.MOUSEBUTTONDOWN and paires_trouvees < nb_lignes * nb_colonnes // 2:
            position_souris = pygame.mouse.get_pos()

            essais += 0.5

            for carte in cartes:
                if not carte["carte_identique"] and carte["dessin_carte"].collidepoint(position_souris):
                    
                    cartes_retournees.append(carte)

                    if len(cartes_retournees) == 1:
                        cartes_retournees[0]["carte_identique"] = True

                        pygame.draw.rect(fenetre, "white", carte["dessin_carte"])
                        texte_surface = typo.render(carte["valeur_carte"], True, "blue")
                        texte_rect = texte_surface.get_rect(center = carte["dessin_carte"].center)
                        fenetre.blit(texte_surface, texte_rect)

                        pygame.display.update()

                    if len(cartes_retournees) == 2:
                        cartes_retournees[1]["carte_identique"] = True
                        
                        pygame.draw.rect(fenetre, "white", carte["dessin_carte"])
                        texte_surface = typo.render(carte["valeur_carte"], True, "blue")
                        texte_rect = texte_surface.get_rect(center = carte["dessin_carte"].center)
                        fenetre.blit(texte_surface, texte_rect)

                        pygame.display.update()

                        pygame.time.delay(500)

                        if cartes_retournees[0]["valeur_carte"] == cartes_retournees[1]["valeur_carte"]:
                            paires_trouvees += 1
                        
                        else: 
                            cartes_retournees[0]["carte_identique"] = False
                            cartes_retournees[1]["carte_identique"] = False

                        pygame.display.update()

                        cartes_retournees = []

        for carte in cartes:
            if not carte["carte_identique"]:
                pygame.draw.rect(fenetre, "yellow", carte["dessin_carte"])
                pygame.display.update()
                    
    

    pygame.display.update()
                     

                        
                        
    
                        


    

    

